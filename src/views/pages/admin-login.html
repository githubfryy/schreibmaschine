<!-- Admin Login Page -->
<div class="admin-login-container">
  <div class="admin-login-header">
    <h1>Schreibmaschine</h1>
    <p class="subtitle">Admin-Bereich</p>
  </div>

  <div class="admin-login-form-container">
    <!-- Admin Login Form -->
    <div x-data="adminLogin()" x-init="init()">
      
      <!-- Error Alert -->
      <div x-show="error" x-transition class="error-alert">
        <h3>‚ö†Ô∏è Anmeldung fehlgeschlagen</h3>
        <p x-text="error"></p>
      </div>

      <!-- Login Form -->
      <form @submit.prevent="login()" class="admin-login-form">
        <div class="form-group">
          <label for="password">Admin-Passwort</label>
          <input
            id="password"
            type="password" 
            x-model="password"
            required
            autocomplete="current-password"
            placeholder="Passwort eingeben"
            :disabled="loading"
          />
        </div>

        <div class="form-group">
          <button 
            type="submit" 
            :disabled="loading || !password"
            class="btn-primary admin-login-btn"
          >
            <span x-show="!loading">Anmelden</span>
            <span x-show="loading">üîÑ Anmeldung l√§uft...</span>
          </button>
        </div>
      </form>

      <!-- Development Info -->
      {{#if isDevelopment}}
      <div class="info admin-dev-info">
        <h3>üîß Entwicklungsmodus</h3>
        <p>Standard-Passwort: <code>schreibmaschine2025!</code></p>
      </div>
      {{/if}}

    </div>
  </div>
</div>

<script>
function adminLogin() {
  return {
    password: '',
    loading: false,
    error: null,

    init() {
      // Check if already authenticated
      this.checkAuthStatus();
    },

    async checkAuthStatus() {
      try {
        const response = await fetch('/admin/session', { 
          credentials: 'include' 
        });
        const data = await response.json();
        
        if (data.authenticated) {
          // Already logged in, redirect to dashboard
          window.location.href = '/admin/dashboard';
        }
      } catch (error) {
        // Ignore error, user is not authenticated
      }
    },

    async login() {
      if (!this.password) return;

      this.loading = true;
      this.error = null;

      try {
        const response = await fetch('/admin/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          credentials: 'include',
          body: JSON.stringify({
            password: this.password
          })
        });

        const data = await response.json();

        if (data.success) {
          // Successful login - redirect to dashboard
          window.location.href = '/admin/dashboard';
        } else {
          this.error = data.error || 'Anmeldung fehlgeschlagen';
        }
      } catch (error) {
        this.error = 'Verbindungsfehler. Bitte versuchen Sie es erneut.';
      } finally {
        this.loading = false;
      }
    }
  };
}
</script>